
\chapter{恒等式}
\label{chap:identities}

\section{基本恒等式}
\label{sec:basic-identities}

\begin{example}[两数和的幂]$\forall a,b\in\mathcal{R}$，有
  \begin{align*}
    (a + b)^2 &= a^2 + 2ab + b^2\\
    (a + b)^3 &= a^3 + 3a^2b + 3ab^2 + b^3\\
    (a + b)^4 &= a^4 + 4a^3b + 6a^2b^2 + 4ab^3 + b^4
  \end{align*}
\end{example}
对于$(a-b)^2$及$(a-b)^3$这种，只要在上式中把$b$换为$-b$即可。观察上述$(a+b)^n$的系数，可以发现其与下面的杨辉三角是一致的：
\begin{center}
  \begin{tikzpicture}[scale=1.0]
    \begin{scope}[shift={(.5,1)}]
      \foreach \x/\v in {1/1,2/1}{%
        \node at (\x,0) {\v};
      }
    \end{scope}
    \begin{scope}[shift={(0,0)}]
      \foreach \x/\v in {1/1,2/2,3/1}{%
        \node at (\x,0) {\v};
      }
    \end{scope}
    \begin{scope}[shift={(-.5,-1)}]
      \foreach \x/\v in {1/1,2/3,3/3,4/1}{%
        \node at (\x,0) {\v};
      }
    \end{scope}
    \begin{scope}[shift={(-1,-2)}]
      \foreach \x/\v in {1/1,2/4,3/6,4/4,5/1}{%
        \node at (\x,0) {\v};
      }
    \end{scope}
    \begin{scope}[shift={(-1.5,-3)}]
      \foreach \x/\v in {1/1,2/5,3/10,4/10,5/5,6/1}{%
        \node at (\x,0) {\v};
      }
    \end{scope}
    \foreach \y in{1,2,3,4,5}{%
      \node[left] at (-2,2-\y){$n=\y$};
    }
  \end{tikzpicture}
\end{center}


\begin{example}[配方]$\forall a\ne 0$，有
  \begin{align*}
    ax^2 + bx + c = a\left(x-\frac{b}{2a}\right)^2 + \frac{4ac - b^2}{4a}
  \end{align*}
\end{example}

\section{代数}
\label{sec:algebra-identities}

\begin{theorem}[Sophie-Germain恒等式]
  $\forall x,y$，有
  \begin{align*}
    x^4 + 4y^4 = (x^2 + 2xy + 2y^2)(x^2 - 2xy + 2y^2)
  \end{align*}
\end{theorem}
在上式中令$x=1$，可以得到哥德巴赫定理；令$y=1$，则可以得到吉梅茵定理。
\begin{theorem}[哥德巴赫定理，Goldbach Theorem]\mbox{}\par
  对任意整数$n>1$，$4n^4+1=(1+2n+2n^2)(1-2n+2n^2)$是合数。  
\end{theorem}
\begin{theorem}[吉梅茵定理，Germain Theorem]\mbox{}\par
  任意整数$n>1$，$n^4+4=(n^2+2n+2)(n^2-2n+2)$是合数。
\end{theorem}


\begin{theorem}[贝祖定理，B\'ezout's identity]\label{th:Bezout}
  $\forall a,b\in\mathcal{Z},\exists x,y\in\mathcal{Z}$使得
  \begin{align*}
    ax+by=\mathrm{gcd}(a,b)
  \end{align*}
  若$a,b$互质，则有$ax+by=1$。
\end{theorem}

\begin{theorem}\label{th:inverse-bezout}
  若整数$x,y,a,b$满足$ax+by=1$，则$x,y$互质。从而$\gcd(a,b)=\gcd(a,y)=\gcd(x,b)=\gcd(x,y)=1$。
\end{theorem}
\begin{proof}
  记$g=\gcd(x,y)$，则$x'=x/g$与$y'=y/g$是互质的两个整数，代入有
  \begin{align*}
    1=ax+by=ax'g+by'g=g(ax'+by')
  \end{align*}
  从而$g\mid 1\implies g=1$。
\end{proof}

%%% $x,y$称为$(a,b)$的B\'ezout系数。一般来说，$(a,b)$的B\'ezout系数$x,y$不是唯一的，可以通过扩展欧几里得算法来计算得到。
$x,y$称为$(a,b)$的B\'ezout系数。一般来说，$(a,b)$的B\'ezout系数$x,y$不是唯一的，可以通过类似于欧几里得辗转相除法得到。

\begin{example}
  求整数$a,b$使得$211a+37b=1$。
\end{example}
\begin{proof}[提示]
\begin{align*}
  211a+37b=1 &\iff 37b=1-211a \\
             &\iff b=\frac{1-211a}{37}=-5a+\frac{1-26a}{37}\\
             &\iff b=-6a+\frac{1+11a}{37} 
\end{align*}
令$1+11a=37t_1$，其中$t_1$为整数，从而
\begin{align*}
  1+11a=37t_1 & \iff a=\frac{37t_1-1}{11}=3t_1 + \frac{4t_1-1}{11}
\end{align*}
令$4t_1-1=11t_2$，其中$t_2$为整数，则$t_1=2t_2+(3t_2+1)/4$。若能观察出来取$t_2=1$可使$t_1$为整数，则代入即可。

若观察不出来，继续令$3t_2+1=4t_3$，则$t_2=t_3+(t_3-1)/3$，若还观察不出来$t_3$应取什么值可使$t_2$为整数，继续令$t_3-1=3t_4$，从而$t_3=3t_4+1$，整数$t_4$可随意挑选，再一步步反向代入，可得$t_3,t_2,t_1,a,b$。
\end{proof}


% \begin{definition}[扩展欧几里得算法]
%   Ref. \verb|https://en.wikipedia.org/wiki/Extended_Euclidean_algorithm|
% \end{definition}

\begin{example}[1959 IMO]
  求证对任意正整数$n$，分数$\dfrac{21n+4}{14n+3}$不可约。
\end{example}
\begin{proof}[提示]
  相当于证明$21n+4$与$14n+3$互质。尝试使用定理\ref{th:inverse-bezout}，若能找到两个整数$a,b$，使得$a(21n+4)+b(14n+3)=1$，则有$21n+4$与$14n+3$互质。而
  \begin{align*}
    a(21n+4)+b(14n+3)=1 \iff (21a + 14b)n + 4a + 3b = 1
  \end{align*}
  而上式要对任意整数$n$成立，等价于以下两式同时成立
  \begin{align*}
    21a+14b=0, \quad 4a+3b=1
  \end{align*}
  而这个方程组是有整数解$a=-2, b=3$，从而原问题得证。
\end{proof}

\begin{example}\label{ex:sum-is-negative-to-product}
  对任意满足$a+b\ne0$，$b+c\ne0$，$c+a\ne0$的实数$a,b,c$，则以下三个数的和与积互为相反数：
  \begin{align*}
    \frac{a-b}{a+b},\quad \frac{b-c}{b+c},\quad \frac{c-a}{c+a}
  \end{align*}
  即
  \begin{align*}
    \frac{a-b}{a+b} + \frac{b-c}{b+c} + \frac{c-a}{c+a} 
    + \frac{a-b}{a+b} \cdot \frac{b-c}{b+c} \cdot \frac{c-a}{c+a} = 0
  \end{align*}
\end{example}
\begin{proof}
  引入几个记号：
  \begin{align*}
    S_{l}\equiv&\, \frac{a-b}{a+b} + \frac{b-c}{b+c} + \frac{c-a}{c+a} \\
    S_{r}\equiv&\,\frac{a-b}{a+b} \cdot \frac{b-c}{b+c} \cdot \frac{c-a}{c+a}\\
    P\equiv&\,S_{r}\cdot (a+b)(b+c)(c+a) = (a-b)(b-c)(c-a)
  \end{align*}
  则问题中的等式等价于
  \begin{align*}
    S_{l}\cdot (a+b)(b+c)(c+a) + P = 0
  \end{align*}
  最直接的方法，是逐项展开，合并同类项。
  \begin{align*}
     &\, S_{l}\cdot (a+b)(b+c)(c+a)\\
    =&\, (a-b)(b+c)(c+a) + (b-c)(c+a)(a+b) + (c-a)(a+b)(b+c)\\
    =&\, (c+a)\left( (a-b)(b+c) + (b-c)(a+b) \right) + (c-a)(a+b)(b+c)\\
    =&\, 2b(c+a)(a-c) + (c-a)(a+b)(b+c)\\
    =&\, (a-c)(2bc+2ab - (ab+ac+bb+bc))\\
    =&\, (a-c)(bc+ab - ac-bb)\\
    =&\, (a-c)(c(b-a)+b(a-b))\\
    =&\, (a-c)(b-a)(c-b)\\
    =&\, -(a-b)(b-c)(c-a) = -P&&\qedhere
  \end{align*}
\end{proof}

\begin{example}
  若$a=3,b=4,c=5$，则
  \begin{align*}
    \frac{a-b}{a+b} = \frac{3-4}{3+4} = -\frac17\\
    \frac{b-c}{b+c} = \frac{4-5}{4+5} = -\frac19\\
    \frac{c-a}{c+a} = \frac{5-3}{5+3} = \phantom{-}\frac14
  \end{align*}
  其和为
  \begin{align*}
    -\frac17 - \frac19 + \frac14 = \frac{-9\times4 - 7\times4 + 7\times9}{4\times7\times9} = -\frac1{4\times7\times9}
  \end{align*}
  容易看出，其和为其积的相反数。
\end{example}

\section{重要恒等式}
\label{sec:important-identities}

以下几个恒等式不常见，却是竞赛中的常客。虽无需记忆，但可以留点印象，知道有这么回事，对解题有大帮助。

\begin{example}\label{ex:product-of-four-continuous-integer}
  证明对任意$x\in\mathcal{R}$，有
  \begin{align*}
    x(x+1)(x+2)(x+3)+1=\left( x^2+3x+1\right )^2
  \end{align*}
\end{example}
展开两边可得。换一个形式，则有
\begin{align*}
  \sqrt{x(x+1)(x+2)(x+3)+1}= x^2+3x+1 = (x + 1)^2 + x
\end{align*}


\begin{example}
  求$\sqrt{2019\times2020\times2021\times2022+1}-2020^2$。

  在恒等式$\sqrt{x(x+1)(x+2)(x+3)+1}= x^2+3x+1 = (x + 1)^2 + x$中令$x=2019$，则有
  $\sqrt{2019\times2020\times2021\times2022+1}-2020^2=2019$。
\end{example}

\begin{theorem}[Fibonacci Identity]任意实数$a,b,c,d$，有恒等式
  \begin{align*}
    \left(a^2+b^2\right)\left(c^2+d^2\right)
    = \left(ac +  bd\right)^2 + \left(ad -  bc\right)^2
    = \left(ac -  bd\right)^2 + \left(ad +  bc\right)^2 
  \end{align*}
\end{theorem}


\begin{theorem}
  若$\alpha, \beta, \gamma$均非$\pi/2$的奇数倍，则等式
  \begin{align*}
    \tan\alpha +\tan\beta+\tan\gamma=\tan\alpha \cdot \tan\beta \cdot \tan\gamma
  \end{align*}
  当且仅当$\alpha+\beta+\gamma$是$\pi$的整数倍时成立。
\end{theorem}